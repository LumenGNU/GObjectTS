# GJS Reality Check.md

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –±–∑–∏–∫–∏ GJS (JS/Typescript)

–≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞ –∫–∞–∫ –∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, —Ç–∞–∫ –∏ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è—Ö –∏ —Ç–µ—Å—Ç–∞—Ö.


## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è GJS

GJS != Browser != Node.js

GJS –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ "some widely used standards from the Web API" –∏ "does not include support for most of these APIs" - –æ–Ω–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç Web API —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–º–∏ –±–∞–∑–æ–≤—ã–º–∏.


### –ß—Ç–æ –î–û–°–¢–£–ü–ù–û –≤ GJS:
- setTimeout/setInterval - –¥–æ—Å—Ç—É–ø–Ω—ã —Å GJS 1.70 (GNOME 41) –∫–∞–∫ —á–∞—Å—Ç—å WHATWG Timers API
- Console API - –¥–æ—Å—Ç—É–ø–µ–Ω —Å GJS 1.70
- TextEncoder/TextDecoder - –¥–æ—Å—Ç—É–ø–Ω—ã —Å GJS 1.70


### ‚ùå –ß—Ç–æ –ù–ï –¥–æ—Å—Ç—É–ø–Ω–æ –≤ GJS:
- AbortController/AbortSignal - –Ω–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- requestIdleCallback - –Ω–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- fetch - —è–≤–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω: "GJS is not intended as an environment for web development and does not include support for most of these APIs"
- URL constructor - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Gio.File.new_for_uri() –≤–º–µ—Å—Ç–æ new URL()


## Memory management

*–ö–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç—ã GTK —É–±–∏—Ä–∞—é—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞?*
*–û—Ç–≤–µ—Ç:* –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ.

*–ù—É–∂–Ω–æ –ª–∏ —è–≤–Ω–æ –æ—Ç–∫–ª—é—á–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –∏–ª–∏ —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?*
*–û—Ç–≤–µ—Ç:* –í —Ä—É—á–Ω—É—é –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã - –æ—Ç–∫–ª—é—á–∞—Ç—å –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é. –û—Ç–∫–ª—é—á–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –°–∏–≥–Ω–∞–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ builder (–≤ template) - –±—É–¥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—Å—è builder`–æ–º.

*–ü—Ä–æ–±–ª–µ–º—ã —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –≤–∏–¥–∂–µ—Ç ‚Üî –∫–æ–ª–±–µ–∫?*
*–û—Ç–≤–µ—Ç:* –î–∞, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ.

**–ù–µ–º–Ω–æ–≥–æ –æ memory management**:

GJS ‚Äî —ç—Ç–æ JavaScript-–ø—Ä–∏–≤—è–∑–∫–∏ –¥–ª—è GNOME, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∑–∞ –∫—É–ª–∏—Å–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–≤–∞ —Ç–∏–ø–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ (JavaScript) –∏ –ø–æ–¥—Å—á–µ—Ç —Å—Å—ã–ª–æ–∫ (GObject).

–ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Å—ã–ª–æ–∫: –∫–æ–≥–¥–∞ GObject —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ, –µ–≥–æ —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ —Ä–∞–≤–µ–Ω 1. –ö–æ–≥–¥–∞ —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –ø–∞–¥–∞–µ—Ç –¥–æ 0, –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –ø–∞–º—è—Ç—å –æ–±—ä–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ—é GObject.

–ö–æ–Ω—Ü–µ–ø—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É, –ø–æ—Å–∫–æ–ª—å–∫—É –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤. –ù–æ –≤ –æ–±—â–∏—Ö —á–µ—Ä—Ç–∞—Ö: –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–∏—Å–≤–æ–µ–Ω –Ω–∏–∫–∞–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –æ–Ω –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –µ—Å–ª–∏ –¥–≤–∏–∂–æ–∫ JavaScript –Ω–µ –º–æ–∂–µ—Ç ¬´–æ—Ç—Å–ª–µ–¥–∏—Ç—å¬ª –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –æ–Ω –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ.

–¢–æ –µ—Å—Ç—å, –ø–æ–∫–∞ GJS –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å GObject –¥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –æ–Ω –±—É–¥–µ—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å, —á—Ç–æ–±—ã —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –Ω–µ –æ–ø—É—Å–∫–∞–ª—Å—è –¥–æ 0.

–î—Ä—É–≥–∏–µ GObjects –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ GObjects, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—ä–µ–∫—Ç-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ–ª—å–∑—è –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π JavaScript, –æ–Ω –±—É–¥–µ—Ç –∏–º–µ—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –∏ –Ω–µ –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω.

~~~js
let myLabel = new Gtk.Label({
    label: 'Some Text',
});

// –ö–∞–∫ —Ç–æ–ª—å–∫–æ –º—ã –¥–æ–±–∞–≤–∏–º `myLabel` –∫ `myFrame`, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –Ω–∞ GObject
// —É–≤–µ–ª–∏—á–∏—Ç—Å—è –∏ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –µ–≥–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ –µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è
// –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π JavaScript.
const myFrame = new Gtk.Frame();
myFrame.set_child(myLabel);

// –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ GObject –∏–∑ `myLabel`, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –µ–≥–æ
// –≤ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
// –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç
// –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å GObject, –∫–æ–≥–¥–∞ –≤—ã–π–¥–µ—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏.
myLabel = null;
~~~

–û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–µ—â—å—é, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É—é—â–µ–π —Å–±–æ—Ä—É GObject, —è–≤–ª—è–µ—Ç—Å—è –¥—Ä—É–≥–æ–π GObject, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å—Å—ã–ª–∫—É, —Ç–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω –æ—Ç–∫–∞–∂–µ—Ç—Å—è –æ—Ç —ç—Ç–æ–π —Å—Å—ã–ª–∫–∏, –æ–Ω–∞ –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞.

~~~js
const myFrame = new Gtk.Frame();

if (myFrame) {
    const myLabel = new Gtk.Label({
        label: 'Some Text',
    });

    myFrame.set_child(myLabel);
}

// –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –Ω–∞ GtkLabel —É–º–µ–Ω—å—à–∏—Ç—Å—è –¥–æ 0, –∏ GObject –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω.
myFrame.set_child(null);
~~~

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ GJS, –Ω–æ –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –§—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç GObject, –∫–∞–∫ –µ—Å–ª–∏ –±—ã –µ–≥–æ —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ —É–ø–∞–ª –¥–æ 0. –ù–æ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–º–µ—à–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π JavaScript –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç GObject.

–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ GObject –ø–æ—Å–ª–µ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è) —è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞. –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π –æ–±—ä–µ–∫—Ç –≤—ã–∑–æ–≤–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É.

–≠—Ç–æ –Ω–∞–¥—É–º–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä, –Ω–æ —Å–º—ã—Å–ª –ø–µ—Ä–µ–¥–∞–µ—Ç:
~~~js
const myFrame = new Gtk.Frame();

if (myFrame) {
    const myLabel = new Gtk.Label({
        label: 'Some Text',
    });

    myFrame.set_child(myLabel);
...
    // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫ –Ω–∞ GtkLabel —É–º–µ–Ω—å—à–∏—Ç—Å—è –¥–æ 0, –∏ GObject –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω.
    myFrame.set_child(null);

    // –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ —Ç–æ–π-–∂–µ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —á—Ç–æ –∏ myLabel, –ø–æ—ç—Ç–æ–º—É
    // –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∑–Ω–∞—á–µ–Ω–∏–µ `null`, —á—Ç–æ–±—ã —Å–±–æ—Ä—â–∏–∫
    // –º—É—Å–æ—Ä–∞ –º–æ–≥ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –æ–±–µ—Ä—Ç–∫—É JS.
    myLabel = null;
...
}
~~~

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –≤—ã–∑–≤–∞—Ç—å —É—Ç–µ—á–∫—É —Å—Å—ã–ª–æ–∫ ‚Äî –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–ª–∏ –≤—ã–≤–µ—Å—Ç–∏ –µ–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏. –ï—Å–ª–∏ —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ GObject —Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Å—á–µ—Ç—á–∏–∫–æ–º —Å—Å—ã–ª–æ–∫, –∑–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –Ω–µ—Å–µ—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –≤—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç–µ —É—Ç–µ—á–∫—É –µ–≥–æ –ø–∞–º—è—Ç–∏.

–ï—Å–ª–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Å–∏–≥–Ω–∞–ª–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –≤—ã —É–ø—É—Å—Ç–∏—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É.

~~~js
export default class ExampleExtension extends Extension {
    enable() {
        const indicator = new PanelMenu.Button(0.0, 'MyIndicator', false);
        const randomId = GLib.uuid_string_random();

        Main.panel.addToStatusArea(randomId, indicator);
    }

    disable() {
        // –ö–æ–≥–¥–∞ `enable()` –∑–∞–≤–µ—Ä—à–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∏ `indicator`, –∏ `randomId` –≤—ã—à–ª–∏ –∏–∑
        // –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã GC.
        // –û–¥–Ω–∞–∫–æ –æ–±–ª–∞—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –≤—Å–µ –µ—â–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ GObject PanelMenu.Button.
        //
        // –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è/–≤–∫–ª—é—á–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏
        // –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —ç–∫—Ä–∞–Ω–∞), –∫ –ø–∞–Ω–µ–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π, –Ω–µ —É–¥–∞–ª—è–µ–º—ã–π
        // –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä.
    }
}
~~~

~~~js
export default class ExampleExtension extends Extension {
    enable() {
        this._indicators = {};

        const indicator1 = new PanelMenu.Button(0.0, 'MyIndicator1', false);
        const indicator2 = new PanelMenu.Button(0.0, 'MyIndicator2', false);

        Main.panel.addToStatusArea(GLib.uuid_string_random(), indicator1);
        Main.panel.addToStatusArea(GLib.uuid_string_random(), indicator2);

        this._indicators['MyIndicator1'] = indicator1;
        this._indicators['MyIndicator1'] = indicator2;
    }

    disable() {
        // –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –∞–≤—Ç–æ—Ä –∫–æ–¥–∞ –Ω–∞–º–µ—Ä–µ–≤–∞–ª—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        // –≤ –æ–±—ä–µ–∫—Ç–µ indicators, –æ–Ω –¥–æ–ø—É—Å—Ç–∏–ª –Ω–µ–±–æ–ª—å—à—É—é –æ—à–∏–±–∫—É: —Å—Å—ã–ª–∫–∞ –Ω–∞ indicator2
        // —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ indicators['MyIndicator1'], –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—è —Å—Å—ã–ª–∫—É –Ω–∞ indicator1!
        // –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç –ø–æ–¥ indicator1 —Ç–µ—Ä—è–µ—Ç—Å—è, –∏ –æ–±—ä–µ–∫—Ç –Ω–µ –º–æ–∂–µ—Ç
        // –±—ã—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω –≤ disable().
        for (const [name, indicator] of Object.entries(this._indicators))
            indicator.destroy();

        this._indicators = {};
    }
}
~~~

–û—á–µ–Ω—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º —É—Ç–µ—á–∫–∏ GSource —è–≤–ª—è–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö (–ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è) –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π GLib. –û–±—ã—á–Ω–æ —ç—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ü–∏–∫–ª—ã —Å —Ç–∞–π–º–∞—É—Ç–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ–≥–æ-–ª–∏–±–æ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —É—Ç–µ—á–∫–∞ –≤—ã–∑–≤–∞–Ω–∞ —Ç–µ–º, —á—Ç–æ –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ GSource, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —É—Ç—Ä–∞—Ç–∏–ª –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –µ–µ —É–¥–∞–ª–∏—Ç—å. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –±—É–¥–µ—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–∞ –ø–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É –ø–æ—Å–ª–µ –µ–≥–æ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ:

~~~js
const MyIndicator = GObject.registerClass(
class MyIndicator extends PanelMenu.Button {
    startUpdating() {
        // –ö–æ–≥–¥–∞ `startUpdating()` –≤–µ—Ä–Ω–µ—Ç—Å—è, –º—ã –ø–æ—Ç–µ—Ä—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
        // `sourceId`, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–µ —Å–º–æ–∂–µ–º —É–¥–∞–ª–∏—Ç—å –µ–≥–æ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.
        const sourceId = GLib.timeout_add_seconds(GLib.PRIORITY_DEFAULT, 5,
            this.update.bind(this));
    }

    update() {
        // –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±—ã–ª —É–Ω–∏—á—Ç–æ–∂–µ–Ω, —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ.
        //
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Function.bind() –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å `this` –¥–æ –æ–±—ä–µ–∫—Ç–∞
        // JavaScript, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è GObject.
        this.visible = !this.visible;

        // –í–æ–∑–≤—Ä–∞—Ç `true` –∏–ª–∏ `GLib.SOURCE_CONTINUE` –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç GSource
        // —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è, —Ç–∞–∫ —á—Ç–æ –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
        // —Å–ª–µ–¥—É—é—â–∏–π —Ç–∞–π–º-–∞—É—Ç.
        return GLib.SOURCE_CONTINUE;
    }

    _onDestroy() {
        // –£ –Ω–∞—Å –Ω–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ `sourceId, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–µ –º–æ–∂–µ–º —É–¥–∞–ª–∏—Ç—å
        // –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–∑ —Ü–∏–∫–ª–∞. –ù–∞–º —Å–ª–µ–¥–æ–≤–∞–ª–æ –±—ã –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        // –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞

        super._onDestroy();
    }
});


export default class ExampleExtension extends Extension {
    enable() {
        this._indicator = new MyIndicator();

        // –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è, –Ω–æ–≤—ã–π GSource –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
        // —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π.
        this._indicator.startUpdating();
    }

    disable() {
        this._indicator.destroy();
        this._indicator = null;

        // –î–∞–∂–µ –µ—Å–ª–∏ –º—ã —É–Ω–∏—á—Ç–æ–∂–∏–ª–∏ GObject –∏ –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∏ –µ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑
        // –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `indicator`, –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ GSource –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
        // –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.
    }
}
~~~

–ö–∞–∫ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, —Å–∏–≥–Ω–∞–ª, –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞. –ù–µ—É–¥–∞—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å—Ü–µ–Ω–∞—Ä–∏—è–º ¬´–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è¬ª, –Ω–æ —Ç–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω—ã –∏ —É—Ç–µ—á–∫–∏ —Å—Å—ã–ª–æ–∫ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –≤—ã–∑–æ–≤–µ.

–í –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –Ω–∏–∂–µ –ø—Ä–∏–º–µ—Ä–µ –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ 'changed::licensed' –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å `agent`. –û–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ constructor(). –§–∞–∫—Ç–∏—á–µ—Å–∫–∏, –¥–∞–∂–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ `myObject` –≤ `null` –≤ `disable()`, —Å–ª–æ–≤–∞—Ä—å –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∏–∑ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Å–∏–≥–Ω–∞–ª–∞.

~~~js
const mySettings = new Gio.Settings({
    schema_id: 'org.gnome.desktop.interface',
});

class MyObject {
    constructor() {
        const agent = {
            'family': 'Bond',
            'given': 'James',
            'codename': '007',
            'licensed': true,
        };

        // –ó–¥–µ—Å—å –º—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
        const id = mySettings.connect('changed::licensed', (settings, key) => {
            // –ó–¥–µ—Å—å –º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Å–ª–æ–≤–∞—Ä—å `agent`. –ü–æ—Å–∫–æ–ª—å–∫—É
            // –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ —Ç–µ—Ä—è–µ—Ç—Å—è, –æ–Ω –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è, –∏
            // –ø–æ—ç—Ç–æ–º—É —Å–ª–æ–≤–∞—Ä—å `agent` —Ç–æ–∂–µ —É—Ç–µ–∫–∞–µ—Ç.
            agent.licensed = mySettings.get_boolean(key);
        });
    }
}

export default class ExampleExtension extends Extension {
    enable() {
        this._myObject = new MyObject();
    }

    disable() {
        this._myObject = null;
    }
}
~~~

Cairo —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –≤ GJS, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ –∫–æ–Ω—Ü–µ –º–µ—Ç–æ–¥–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Ä—É—á–Ω—É—é –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å CairoContext. –≠—Ç–æ –ª–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–æ –µ—Å–ª–∏ –∑–∞–±—ã—Ç—å - –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —É—Ç–µ—á–∫–∞ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∞–º—è—Ç–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –≤–∏–¥–∂–µ—Ç—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ.

~~~js
// Create a drawing area and set a drawing function
const drawingArea = new Gtk.DrawingArea();

drawingArea.set_draw_func((area, cr, _width, _height) => {
    // Perform operations on the surface context

    // Freeing the context before returning from the callback
    cr.$dispose();
});
~~~


## Event loop –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å

*–û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å JS vs GTK main loop*
*–û—Ç–≤–µ—Ç*: JS –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤, –∫–∞–∫ –Ω–∏ —Å—Ç—Ä–∞–Ω–Ω–æ, –≤ –ø–æ—Ç–æ–∫–µ JS. –ù–æ, —Ä–∞–±–æ—Ç–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ—Ç–æ–¥-—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –≤ –ø–æ—Ç–æ–∫–µ GLib. –ò, —Ö–æ—Ç—è, –Ω–∞ —É—Ä–æ–≤–Ω–µ GLib —ç—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è - –≤—ã–∑–æ–≤ —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –≤–µ—Ä–Ω—É—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ JS, —Ö–æ—Ç—è –º–µ—Ç–æ–¥ –≤—Å–µ –µ—â–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏.

*–ú–æ–∂–Ω–æ –ª–∏ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Ç–æ —á—Ç–æ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏ –∫–æ–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∫–ª–∏–Ω–∏—Ç—Å—è?*
*–û—Ç–≤–µ—Ç*: –ú–æ–∂–Ω–æ, JS —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –æ—Ç –Ω–µ–≥–æ –∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è.


### –¢–∞–π–º–µ—Ä—ã –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

New in GJS 1.72 (GNOME 42)


#### `setInterval`/`setTimeout` vs `GLib.timeout_add` - –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

`setInterval` –∏ `setTimeout` –≤ GJS —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ `GLib.timeout_add`, –Ω–æ –±–æ–ª–µ–µ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø–æ—Ç–æ–∫–µ JS. –¢–æ–≥–¥–∞ –∫–∞–∫ `GLib.timeout_add`, –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã, –ø–æ—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ "—Å–æ–∑–¥–∞—Ç—å –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–æ–ª–±—ç–∫").


### –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç, –∫–∞–∫ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

GJS —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é WHATWG Timers —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏, —á—Ç–æ–±—ã –ø—Ä–∏—Å–ø–æ—Å–æ–±–∏—Ç—å —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π GLib.

–í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π `setInterval()` –∏ `setTimeout()` - —ç—Ç–æ –Ω–µ —á–∏—Å–ª–æ, –∞ –æ–±—ä–µ–∫—Ç `GLib.Source`.

**–ò–º–ø–æ—Ä—Ç**: –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ, –±–µ–∑ –∏–º–ø–æ—Ä—Ç–∞.

~~~js
/** **setTimeout**
 * –ü–ª–∞–Ω–∏—Ä—É–µ—Ç —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ delay –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥.
 * –õ—é–±—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.
 * @param callback –û–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å
 * @param delay –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
 * –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
 * @param args –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤
 * @returns –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä */
`function setTimeout(callback: (...args: any[]) => any, delay?: number, ...args: any[]): GLib.Source`

/** **clearTimeout**
 * –û—Ç–º–µ–Ω—è–µ—Ç —Ç–∞–π–º–∞—É—Ç, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ setTimeout()
 * @param timeout –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ */
`function clearTimeout(timeout: GLib.Source): void`

/** **setInterval**
 * –ü–ª–∞–Ω–∏—Ä—É–µ—Ç —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–∞–∂–¥—ã–µ delay –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥.
 * –õ—é–±—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.
 * @param callback –û–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å
 * @param delay –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö –æ–∂–∏–¥–∞–Ω–∏—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ
 * –≤—ã–∑–æ–≤–∞
 * @param args –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤
 * @returns –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä */
`function setInterval(callback: (...args: any[]) => any, delay?: number, ...args: any[]): GLib.Source`

/** **clearInterval**
 * –û—Ç–º–µ–Ω—è–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ setInterval()
 * @param interval –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ */
`function clearInterval(interval: GLib.Source): void`
~~~

`setInterval`/`setTimeout` - –ª—É—á—à–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å JS/GC –ø–æ—ç—Ç–æ–º—É –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–π GLib.timeout_add

–ù–û, –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å "–Ω–æ". –ü–æ–ª—å–∑—É–π—Å—è –∑–¥—Ä–∞–≤—ã–º —Å–º—ã—Å–ª–æ–º.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–∏:
- [–†–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ç–∞–π–º–µ—Ä–æ–≤ –≤ GJS](https://gitlab.gnome.org/GNOME/gjs/-/blob/master/modules/esm/_timers.js)
- [Asynchronous Programming in GJS](https://gjs.guide/guides/gjs/asynchronous-programming.html)


## Error handling:

*–ö–∞–∫–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –º–æ–≥—É—Ç –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å GTK –º–µ—Ç–æ–¥—ã?*:
*–û—Ç–≤–µ—Ç*: –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±—ä–µ–∫—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç JS Error, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ - –ø–µ—Ä–µ–¥–∞—é—Ç –∫–∞–∫ –æ—à–∏–±–∫—É GLib.Error. –ù—É –∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞—é Critical Error, —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –ø–∞–¥–µ–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

*–°—Ç–æ–∏—Ç –ª–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤—Å–µ –≤ try-catch?*:
*–û—Ç–≤–µ—Ç*: –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ –ø–æ–ø—Ä–æ—Å—Ç—É –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ. –í—Å–µ —Ç—Ä–µ–±—É–µ—Ç —Å–≤–æ–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.


## GTK Expressions (GtkExpression)

**GtkExpression –†–ê–ë–û–¢–ê–Æ–¢ –≤ GJS!** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö bindings –≤ UI —Ñ–∞–π–ª–∞—Ö.


### –î–æ—Å—Ç—É–ø–Ω–æ:

**–ë–∞–∑–æ–≤—ã–µ expressions:**
- `<constant>` - —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- `<lookup>` - —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤
- `<closure>` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

**Property bindings:**
~~~xml
<binding name="label">
    <lookup name="visible-child-name">stack_object</lookup>
</binding>
~~~

Closure expressions —Å –º–µ—Ç–æ–¥–∞–º–∏ –∫–ª–∞—Å—Å–∞:

~~~xml
<binding name="visible">
    <closure type="gboolean" function="should_show_toggle">
        <lookup name="visible-child-name">onair_stack</lookup>
        <lookup name="show-sidebar">split_view</lookup>
    </closure>
</binding>
~~~

~~~typescript
private should_show_toggle(_: typeof this, page: string, sidebar: boolean): boolean {
    return page === 'interactive' && !sidebar;
}
~~~

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: closure –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ lookup –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.

–ò –æ—Å—Ç–∞–ª—å–Ω–æ–µ.


### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

- Conditional visibility - –ø–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ —Å–ª–æ–∂–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- Dynamic content - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞/–∏–∫–æ–Ω–æ–∫
- Complex bindings - —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤
- –ó–∞–º–µ–Ω–∞ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–¥–∞ - –≤–º–µ—Å—Ç–æ —Å–∏–≥–Ω–∞–ª–æ–≤ + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–í—ã–≤–æ–¥: –ò—Å–ø–æ–ª—å–∑—É–π expressions –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ UI!


### Expression lookups

Expression lookups —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å:

‚úÖ GObject properties:
~~~typescript
@GDecorator.StringProperty()
get my_property() { ... }  // ‚Üê –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ lookup
~~~

‚úÖ GTK/GLib properties:
<lookup name="visible">SomeWidget</lookup>  <!-- GTK —Å–≤–æ–π—Å—Ç–≤–æ -->
<lookup name="label">SomeLabel</lookup>     <!-- GTK —Å–≤–æ–π—Å—Ç–≤–æ -->

–ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç:

‚ùå JavaScript properties:
array.length        // ‚Üê Error: Type `JSObject` does not support properties
string.charAt()     // ‚Üê Error: Type `JSObject` does not support properties
object.someField    // ‚Üê Error: Type `JSObject` does not support properties

–ü–æ—ç—Ç–æ–º—É closures –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã:
~~~xml
<!-- –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ closure –¥–ª—è JS API -->
<closure type="gint" function="get_length">
    <lookup name="sins">ReportListRowBox</lookup>
</closure>
~~~

~~~typescript
protected get_length(_: this, sins: SinInfo[]): number {
    return sins.length;  // JS property –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –∫–æ–¥–µ
}
~~~

–ì—Ä–∞–Ω–∏—Ü–∞ –º–∏—Ä–æ–≤:
Expression world = —Ç–æ–ª—å–∫–æ GObject
Closure world = –¥–æ—Å—Ç—É–ø –∫ JavaScript API


## STATIC —Ñ–ª–∞–≥–∏ ParamSpec - —Å–º–µ—Ä—Ç–µ–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã!

‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ STATIC_NAME/STATIC_NICK/STATIC_BLURB –≤ GJS
- –ü—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é –ø–∞–º—è—Ç–∏
- –í—ã–∑—ã–≤–∞—é—Ç –ø–∞–¥–µ–Ω–∏—è —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏.

‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ñ–ª–∞–≥–∏:
GObject.ParamFlags.READWRITE // –ë–µ–∑ STATIC –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

–ü—Ä–∏–º–µ—Ä:

~~~javascript
const defaults_meta_info = Object.freeze([
  /* name */ "canonical-name",
  /* nick */ "param-spec-metadata.nick",
  /* blurb */ "param-spec-metadata.blurb",
]);

const spec1 = GObject.param_spec_boolean(
    ...defaults_meta_info,
  /* default_value */ false,
  /* flags */ GObject.ParamFlags.READWRITE | GObject.ParamFlags.STATIC_NAME | GObject.ParamFlags.STATIC_NICK,
);

console.log(
    "spec1:",
    [spec1.get_name(), spec1.get_nick(), spec1.get_blurb()].join(", "),
);
~~~

–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä:

~~~
Gjs-Console-Message: 17:47:11.834: spec1: canonical-name, SJ[tKY, param-spec-metadata.blurb
~~~

(–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º—É—Å–æ—Ä –≤–º–µ—Å—Ç–æ blurb)

–ò–ª–∏ –ø–∞–¥–µ–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π —Ç–∏–ø–∞:

~~~
(gjs:153796): Gjs-CRITICAL **: 17:54:05.562: JS ERROR: TypeError: malformed UTF-8 character sequence at offset 2
~~~

GJS –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ JS —Å—Ç—Ä–æ–∫–∏?


### –ü–æ—á–µ–º—É –Ω–µ "–±–æ–ª—å–Ω–æ" –≤ GTK4:

[–ò–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ GObject:](https://docs.gtk.org/gobject/type_func.ParamSpec.internal.html)
> Beyond the name, GParamSpecs have two more descriptive strings, the nick and blurb, which may be used as a localized label and description. For GTK and related libraries these are considered deprecated and may be omitted, while for other libraries such as GStreamer and its plugins they are essential. When in doubt, follow the conventions used in the surrounding code and supporting libraries.

–ú–æ–∂–Ω–æ (–Ω—É–∂–Ω–æ) –ø—Ä–æ—Å—Ç–æ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `nick` –∏ `blurb` –ø–µ—Ä–µ–¥–∞–≤–∞—è `null`. –ò "–ø—Ä–æ–±–ª–µ–º–∞" —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç–æ—Ä–æ–∫ - –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞.


## GTK Template Closures - –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –≤ GJS

~~~typescript
protected ['my-closure'](this: never, _: never, is_valid: boolean, ...): boolean
~~~


### –î–≤–∞ this –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ

*–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω–∏–º–∞—é:
- this: never - —ç—Ç–æ JavaScript –∫–æ–Ω—Ç–µ–∫—Å—Ç (–æ–±—ã—á–Ω—ã–π this)
- _: never - —ç—Ç–æ first –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç GTK (—Ç–æ–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç this –æ–±—ä–µ–∫—Ç–∞)
–¢.–µ. GTK –ø–µ—Ä–µ–¥–∞–µ—Ç this –¥–≤–∞–∂–¥—ã - –∏ –∫–∞–∫ JS –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏ –∫–∞–∫ –ø–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä? –ó–∞—á–µ–º –¥–≤–µ –∫–æ–ø–∏–∏ –∏ –≤ —á–µ–º –º–µ–∂–¥—É –Ω–∏–º–∏ —Ä–∞–∑–Ω–∏—Ü–∞?*
*–û—Ç–≤–µ—Ç*: –î–∞, —Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª. –ó–∞—á–µ–º –¥–≤–µ –∫–æ–ø–∏–∏ –∏ –≤ —á–µ–º –º–µ–∂–¥—É –Ω–∏–º–∏ —Ä–∞–∑–Ω–∏—Ü–∞? -- –∞ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å –∫ —Ç–æ–π <—Ç—É—Ç –±—ã–ª —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π> –∫–æ—Ç–æ—Ä–∞—è –ø–∏—Å–∞–ª–∞ GTK –±–∏–Ω–¥–∏–Ω–≥ –∫ GJS.

GTK –ø–µ—Ä–µ–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—ä–µ–∫—Ç–∞ –¥–≤–∞–∂–¥—ã:
1. **JavaScript `this`** - –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–∑–æ–≤–∞ (–∫–∞–∫ –æ–±—ã—á–Ω–æ –≤ JS)
2. **–ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä** - GTK –ø–µ—Ä–µ–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç-–≤–ª–∞–¥–µ–ª–µ—Ü template

–û–±–∞ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç, –Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [overrides/Gtk.js](https://gitlab.gnome.org/GNOME/gjs/-/blob/master/modules/core/overrides/Gtk.js)


### closures –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å—Ç—ã–º–∏

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ closure –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É (—ç—Ç–æ –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞), –Ω–æ:

- –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º UI
- GTK –≤—ã–∑—ã–≤–∞–µ—Ç closures –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ bindings
- –ù–µ–æ—á–µ–≤–∏–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏ —á–∞—Å—Ç–æ—Ç–∞ –≤—ã–∑–æ–≤–æ–≤
- –¢—Ä—É–¥–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å flow –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü–ª–æ—Ö–æ, –Ω–æ –ø–æ—á–µ–º—É—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ**:

GTK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç bindings –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ï—Å–ª–∏ closure —Å–∞–º –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ bindings, –ø–æ–ª—É—á–∞–µ—Ç—Å—è:

- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –í–æ–∑–º–æ–∂–Ω—ã–µ infinite loops
- Racing conditions –≤ UI
- Performance death

~~~typescript
// Closure –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–≤–æ–π—Å—Ç–≤—É 'filter'
protected ['should-show'](self: typeof this, filter: string): boolean {
    // ‚ùå –ö–ê–¢–ê–°–¢–†–û–§–ê
    this.visible_count = this.calculate_count(filter);  // —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –¥—Ä—É–≥–∏–µ bindings
    return filter.length > 0;
}

// –ì–¥–µ-—Ç–æ –µ—Å—Ç—å binding:
// visible_count ‚Üí label ‚Üí –¥—Ä—É–≥–∞—è closure ‚Üí –º–µ–Ω—è–µ—Ç filter ‚Üí ...
// = –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–ª–∏ —Ö–∞–æ—Ç–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
// –û—Ç–ª–∞–¥–∫–∞ –ø–æ–∫–∞–∂–µ—Ç - –ø—Ä–æ—â–µ –Ω–∞–ø–∏—Å–∞—Ç—å –∑–∞–Ω–æ–≤–æ, —á–µ–º –∏—Å–∫–∞—Ç—å —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å
~~~

**–ü—Ä–∞–≤–∏–ª–æ**: Closure = —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è. –î–ª—è –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π —Å–∏–≥–Ω–∞–ª—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.

**C–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:

~~~xml
<!-- XML –æ–±—ä—è–≤–ª—è–µ—Ç: "—Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ width" -->
<binding name="visible">
    <closure type="gboolean" function="should-show">
        <lookup name="width">widget</lookup>
    </closure>
</binding>
~~~

~~~typescript
// ‚ùå –ù–æ closure —á–∏—Ç–∞–µ—Ç –ï–©–ï –∏ color
protected should_show(self: typeof this, width: number): boolean {
    return width > 100 && this.color === 'red';
}
~~~

~~~typescript
// WTF? –ø–æ—á–µ–º—É –≤–∏–¥–∂–µ—Ç —Ç–∞–∫ —Å—Ç—Ä–∞–Ω–Ω–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç?
~~~

–ü—Ä–æ–±–ª–µ–º–∞:

- GTK –≤–∏–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç width (–∏–∑ XML)
- Closure –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è color
- –ù–û color —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç—Å—è —Ä–∞–∑–º–µ—Ä!
- –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ü–æ—á–µ–º—É –≤–∏–¥–∂–µ—Ç –Ω–µ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ —è –º–µ–Ω—è—é —Ä–∞–∑–º–µ—Ä –∏ (–Ω–µ)—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ —è –º–µ–Ω—è—é —Ü–≤–µ—Ç?!"
- Debug = –∞–¥, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ XML –Ω–µ—Ç –Ω–∞–º–µ–∫–∞ –Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç color

**–ü—Ä–∞–≤–∏–ª–æ**: –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ closure –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —è–≤–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ XML —á–µ—Ä–µ–∑ <lookup>. Closure = —á–∏—Å—Ç–∞—è, –∏ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–∞—è **–¢–û–õ–¨–ö–û** –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

–ü–æ—ç—Ç–æ–º—É, –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, —è —Ç–∏–ø–∏–∑–∏—Ä—É—é –æ–±–∞ —ç—Ç–∏ "this" –∫–∞–∫ `never`, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å **—Å–ª—É—á–∞–π–Ω–æ–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

~~~typescript
// ‚ùå –ü–ª–æ—Ö–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–∫—É—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏—Ö –ø—Ä–æ–±–ª–µ–º—É)
protected ['my-closure'](self: typeof this, value: string): boolean {
    this.list_store.append(value); // boom!
    self.emit('something');  // –ù–ï –î–ï–õ–ê–¢–¨
    self.get_parent().delete_child(this); // PROFIT! –ê —Ç–µ–ø–µ—Ä—å –Ω–∞–π–¥–∏ –º–µ–Ω—è üòÑ
    this.list_store.set_sorter((item_A, item_B) => {
        this.sort_method(item_A, item_B);
    }) // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ Dark Side –Ω–∞ –ø.–º.–∂.
    return value.length > 0;
}
~~~

~~~typescript
// ‚úÖ –•–æ—Ä–æ—à–æ
protected ['my-closure'](this: never, _: never, value: string): boolean {
    // this.list_store.set_filter(value); // ts - –°–≤–æ–π—Å—Ç–≤–æ "list_store" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∏–ø–µ "never".
    // —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    return value.length > 0;
}
~~~


#### –ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è:

–≠—Ç–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ GTK. –í GTK/C closures –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ —Å —è–≤–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

~~~c
gboolean my_closure(gpointer self, const char* value) {
    // self –ø–æ–ª—É—á–µ–Ω —è–≤–Ω–æ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
    // –Ω–µ—Ç "–º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ" –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–¥–µ—Ç—å
    return strlen(value) > 0;
}
~~~

**–ß—Ç–æ –≤ –¥—Ä—É–≥–∏—Ö –±–∏–Ω–¥–∏–Ω–≥–∞—Ö**:

–í–æ –í–°–ï–• –±–∏–Ω–¥–∏–Ω–≥–∞—Ö ClosureExpression –ø–æ–ª—É—á–∞–µ—Ç `this` –∫–∞–∫ –ø–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –ù–û:

Rust:

~~~rust
closure!(|_: Option<Object>, label: &str| {
    format!("{} World", label)
})
~~~

–õ—è–º–±–¥–∞/closure - —Å–≤–æ–±–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –ù–ï –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞. –ù–µ –∏–º–µ–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. `|_: Option<Object>` - –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç —á–µ—Ä–µ–∑ `_`.

C++ (gtkmm):

~~~cpp
Glib::ustring get_string(Glib::RefPtr<Glib::ObjectBase> this_, double a, int b) {
    return Glib::ustring::sprintf("a is %f, b is %d", a, b);
}
~~~

–û–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - –ù–ï –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞. –ù–µ –∏–º–µ–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `this_` (–∫–æ–Ω—Ç–µ–∫—Å—Ç expression) –Ω–æ –æ–Ω –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:
Rust/C++: Closures - —ç—Ç–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –§–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é widget'–∞
- –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä this - –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç GTK
- this - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–≥—É—Ç, –ù–û —Ç–æ–ª—å–∫–æ —è–≤–Ω–æ –æ–±—Ä–∞—â–∞—è—Å—å –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—É
- this - –ø–∞—Ä–∞–º–µ—Ç—Ä, –Ω–µ "–º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç". –ï–≥–æ –Ω–µ–ª—å–∑—è **—Å–ª—É—á–∞–π–Ω–æ** "–∑–∞—Ö–≤–∞—Ç–∏—Ç—å"/"–∏–∑–º–µ–Ω–∏—Ç—å"/"–ø–µ—Ä–µ–¥–∞—Ç—å"

–¢—Ä—É–¥–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

GJS:

GJS: Closures - —ç—Ç–æ –º–µ—Ç–æ–¥—ã –æ–±—ä–µ–∫—Ç–∞ (–∏–Ω—Å—Ç–∞–Ω—Å–∞)
- –ò–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç `this`
- –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `self` - –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç GTK (—Ç–æ—Ç –∂–µ `this`)

–í GJS —Ç—Ä—É–¥–Ω–æ —Å–¥–µ–ª–∞—Ç—å *–ø—Ä–∞–≤–∏–ª—å–Ω–æ*, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É. –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å - –µ—Å—Ç—å —Å–æ–±–ª–∞–∑–Ω —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.


#### –ú–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

~~~typescript
this: never, _: never  // –ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∑–∞—â–∏—Ç–∞
~~~

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ñ–∏–∫—Å –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ GJS. –í–∑–≤–µ—à–µ–Ω–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–∏–Ω–¥–∏–Ω–≥–∞.

–í "–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π" –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (Rust/C++) —Ç–∞–∫–∞—è –∑–∞—â–∏—Ç–∞ –Ω–µ –Ω—É–∂–Ω–∞ - —Ç–∞–º closures —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é, –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ "—Å–ª—É—á–∞–π–Ω–æ".

–ê –≤ GJS - –≤—Å–µ "–∏–Ω–∞—á–µ".


#### –ó–∞–º–µ—á–∞–Ω–∏–µ

*–ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ closure —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞? –ù–∞–ø—Ä–∏–º–µ—Ä:*

~~~typescript
// –•–æ—á—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —É—á–µ—Ç–æ–º user_locale –≤–∏–¥–∂–µ—Ç–∞
protected ['format-date'](this: never, _: never, timestamp: number): string {
    // –ù–æ user_locale —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ this! –ö–∞–∫ –±—ã—Ç—å?
    return format_with_locale(timestamp, this.user_locale); // ‚ùå
}
~~~

–ò–ª–∏ —Ö–æ—á–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤–∏—á–∏—Å–ª–µ–Ω–∏—è –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –æ–±—ä–µ–∫—Ç–µ?

*–û—Ç–≤–µ—Ç*: –°–º–æ—Ç—Ä–∏–º –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: "–ó–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ - –Ω–µ—Ç –∂–µ—Å—Ç–∫–∏—Ö –ø—Ä–∞–≤–∏–ª, –µ—Å—Ç—å —Ü–µ–ª—å –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç"

~~~typescript
// –•–æ—á—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —É—á–µ—Ç–æ–º user_locale –≤–∏–¥–∂–µ—Ç–∞
protected ['format-date'](this: never, self: typeof this, timestamp: number): string {
    return format_with_locale(timestamp, self.user_locale); // –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä `self` (–Ω–µ `this` - –∞ –≤–¥—Ä—É–≥ –∫–ª–æ—Å—É—Ä—ã —Å—Ç–∞–Ω—É—Ç static –≤ –±—É–¥—É—â–µ–º)
}
~~~

–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `user_locale` —á–µ—Ä–µ–∑ `<lookup>` -- —Ç–æ–∂–µ, —Ä–µ—à–µ–Ω–∏–µ. –ù–æ –∑–∞—á–µ–º?


## –¢–∏–ø–∏–∑–∞—Ü–∏—è (–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Typescript)

*–ö–æ–≥–¥–∞ —Ç–∏–ø—ã @girs —Ç–æ—á–Ω—ã–µ, –∞ –∫–æ–≥–¥–∞ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ?*
*–û—Ç–≤–µ—Ç*: –ò—Ö –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ "–≤–ø–æ–ª–Ω–µ —Ç–æ—á–Ω—ã–µ". –ù–æ –Ω—é–∞–Ω—Å—ã –µ—Å—Ç—å –≤—Å–µ–≥–¥–∞!

**–ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª "–Ω—é–∞–Ω—Å—ã"**: –ì–ª—É—à–∏–º
~~~
// @ts-expect-error TS –≥–æ–≤–æ—Ä–∏—Ç —á—Ç–æ ..., –Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏...
~~~

–∏ –∏–¥–µ–º –¥–∞–ª—å—à–µ –≤ –Ω–∞–¥–µ–∂–¥–µ —á—Ç–æ –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –ø–æ—á–∏–Ω—è—Ç.